<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SolScore â€” Solana Wallet Score</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>ðŸ”® SolScore</h1>

    <section class="card">
      <h2>Single Wallet Scan</h2>
      <input id="wallet" placeholder="Enter wallet address" />
      <button id="scanBtn">Scan</button>
      <div id="result" class="result"></div>
    </section>

    <section class="card">
      <h2>Wallet Comparison</h2>
      <input id="walletA" placeholder="Wallet A address" />
      <input id="walletB" placeholder="Wallet B address" />
      <button id="compareBtn">Compare</button>
      <div id="compareResult" class="result"></div>
    </section>

    <footer>
      <small>Live data from Helius (Solana). Built for Artificer Hackathon.</small>
    </footer>
  </div>

  <script>
    const base = ""; // empty => relative paths work both locally and on Render

    function renderWalletSummary(targetEl, data) {
      if (!data) {
        targetEl.innerHTML = "No data.";
        return;
      }
      if (data.error) {
        targetEl.innerHTML = `<div class="error">${data.error}</div>`;
        return;
      }

      const recent = (data.recentTxs || [])
        .map(
          (t) =>
            `<li><strong>${t.signature?.slice(0,8)}...</strong> ${t.blockTime ? new Date(t.blockTime*1000).toLocaleString() : ""} ${t.description ? `- ${t.description}` : ""}</li>`
        )
        .join("");

      const topTokens = (data.topTokens || [])
        .map((tk) => `<li>${tk.symbol}${tk.amount ? `: ${tk.amount}` : ""}</li>`)
        .slice(0,5)
        .join("");

      targetEl.innerHTML = `
        <div><strong>Wallet:</strong> ${data.wallet}</div>
        <div><strong>Score:</strong> ${data.score}/100</div>
        <div><strong>Transactions (recent):</strong> ${data.transactionCount}</div>
        <div><strong>Tokens:</strong> ${data.tokenCount} â€¢ NFTs: ${data.nftCount || 0}</div>
        <div><strong>Wallet age (days):</strong> ${data.walletAgeDays ?? "N/A"}</div>
        <div><strong>Programs interacted:</strong> ${data.programInteractions}</div>
        <div><strong>Risk flags:</strong> ${ (data.riskFlags && data.riskFlags.length) ? data.riskFlags.join(", ") : "None" }</div>
        <div style="margin-top:8px;"><strong>Top tokens:</strong><ul>${topTokens || "<li>None</li>"}</ul></div>
        <div style="margin-top:8px;"><strong>Recent txs:</strong><ul>${recent || "<li>None</li>"}</ul></div>
      `;
    }

    async function scanWallet() {
      const wallet = document.getElementById("wallet").value.trim();
      if (!wallet) return alert("Please enter a wallet address");
      const out = document.getElementById("result");
      out.innerText = "Scanning...";
      try {
        const res = await fetch(base + "/api/score", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ walletAddress: wallet }),
        });
        const data = await res.json();
        if (data.error) out.innerHTML = `<div class="error">${data.error}</div>`;
        else renderWalletSummary(out, data);
      } catch (err) {
        out.innerHTML = `<div class="error">Network error: ${err.message}</div>`;
      }
    }

    async function compareWallets() {
      const a = document.getElementById("walletA").value.trim();
      const b = document.getElementById("walletB").value.trim();
      const out = document.getElementById("compareResult");
      if (!a || !b) return alert("Enter both wallet addresses");
      out.innerText = "Comparing...";
      try {
        const res = await fetch(base + "/api/compare", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ walletA: a, walletB: b }),
        });
        const data = await res.json();
        if (data.error) {
          out.innerHTML = `<div class="error">${data.error}</div>`;
          return;
        }
        // render both summaries side-by-side (stacked)
        out.innerHTML = `<div class="compare">
            <div class="side"><h4>Wallet A</h4><div id="aBox"></div></div>
            <div class="side"><h4>Wallet B</h4><div id="bBox"></div></div>
          </div>
          <div style="margin-top:8px;"><strong>Winner:</strong> ${data.winner}</div>`;

        renderWalletSummary(document.getElementById("aBox"), data.walletA);
        renderWalletSummary(document.getElementById("bBox"), data.walletB);
      } catch (err) {
        out.innerHTML = `<div class="error">Network error: ${err.message}</div>`;
      }
    }

    document.getElementById("scanBtn").addEventListener("click", scanWallet);
    document.getElementById("compareBtn").addEventListener("click", compareWallets);
    // allow Enter to trigger scan on single input
    document.getElementById("wallet").addEventListener("keydown", (e) => {
      if (e.key === "Enter") scanWallet();
    });
  </script>
</body>
</html>
